FROM nvidia/cuda:10.1-cudnn7-devel-ubuntu18.04
LABEL maintainer "lucas.ku <kyungho.ku@poscoict.com>"

ENV CUDNN_VERSION 7.6.4.38
LABEL com.nvidia.cudnn.version="${CUDNN_VERSION}"

ARG DEBIAN_FRONTEND=noninteractive

RUN apt-get update --fix-missing && apt-get upgrade -y \
	&& apt-get install -y openssh-server unzip curl vim\
	&& mkdir --mode 700 /var/run/sshd

RUN echo 'root:q1w2e3r4!' |chpasswd

RUN sed -ri 's/^#?PermitRootLogin\s+.*/PermitRootLogin yes/' /etc/ssh/sshd_config
RUN sed -ri 's/UsePAM yes/#UsePAM yes/g' /etc/ssh/sshd_config

RUN mkdir /root/.ssh

RUN apt-get clean && \
    rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*

EXPOSE 22

CMD    ["/usr/sbin/sshd", "-D"]

=================================================
NV_GPU='2,3,4,5,6,7'  nvidia-docker run -d -it \
                                    --user root \
                                    --hostname facero.com \
                                    --memory="100G" \
                                    --memory-swap=0 \
                                    --shm-size=2G \
                                    --cpus="4" \
                                    -p 22222:22 \
                                    -p 28888:8888 \
                                    -p 26006:6006 \
                                    -p 28000:8000 \
                                    -p 28989:8989 \
                                    -p 33389:33389 \
                                    -e NB_UID=10008 \
                                    -e NB_GID=1002 \
                                    -v /ad-data/facero:/home/facero \
                                    --name facero \
                                    nvidia/cuda:10.0-cudnn7-devel-ubuntu18.04

apt-get install -yq --no-install-recommends \
    wget \
    bzip2 \
    ca-certificates \
    sudo \
    locales \
    fonts-liberation \
    apt-utils \
    curl \
    git \
    vim

=================================================
#sed -i 's/archive.ubuntu.com/mirro.kakao.com/g' /etc/apt/sources.list

sed -i 's/mirro.kakao.com/archive.ubuntu.com/g' /etc/apt/sources.list

docker build  -t lucas.ku/facero:0.1 -f facero.dockerfile .

/usr/local/cuda-10.1-cudnn-v7.6.4

===========
= Summary =
===========

Driver:   Not Selected
Toolkit:  Installed in /usr/local/cuda-10.1/
Samples:  Not Selected

Please make sure that
 -   PATH includes /usr/local/cuda-10.1/bin
 -   LD_LIBRARY_PATH includes /usr/local/cuda-10.1/lib64, or, add /usr/local/cuda-10.1/lib64 to /etc/ld.so.conf and run ldconfig as root

To uninstall the CUDA Toolkit, run cuda-uninstaller in /usr/local/cuda-10.1/bin

Please see CUDA_Installation_Guide_Linux.pdf in /usr/local/cuda-10.1/doc/pdf for detailed information on setting up CUDA.
***WARNING: Incomplete installation! This installation did not install the CUDA Driver. A driver of version at least 418.00 is required for CUDA 10.1 functionality to work.
To install the driver using this installer, run the following command, replacing <CudaInstaller> with the name of this run file:
    sudo <CudaInstaller>.run --silent --driver

Logfile is /var/log/cuda-installer.log


#%Module1.0
proc ModulesHelp { } {
global dotversion

####puts stderr "\tAnaconda Python 2.1 providing Python 2.7.8"
puts stderr "cuda-10.1-cudnn-v7.6.4"


}

module-whatis "Name: cuda-10.1-cudnn-v7.6.4"
prepend-path PATH /usr/local/cuda-10.1-cudnn-v7.6.4/bin
prepend-path LD_LIBRARY_PATH /usr/local/cuda-10.1-cudnn-v7.6.4/lib64:/usr/local/cuda-10.1-cudnn-v7.6.4/lib

